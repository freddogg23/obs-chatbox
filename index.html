<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>7TV Paint Diagnostic</title>
<style>
  html,body{margin:0;height:100%;background:transparent;overflow:hidden;font-family:system-ui,Segoe UI,Arial}
  #pill{position:absolute;left:10px;top:10px;padding:10px 12px;border-radius:999px;
    background:rgba(0,0,0,.55);color:#fff;font-size:12px;max-width:calc(100% - 20px);
    overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
  .row{position:absolute;left:10px;top:50px;color:#fff;font-size:18px;text-shadow:0 2px 8px rgba(0,0,0,.7)}
  .paintText{-webkit-background-clip:text;background-clip:text;color:transparent !important;font-weight:900}
</style>
</head>
<body>
<div id="pill">starting…</div>
<div id="name" class="row">freddogg23</div>

<script>
const pill=document.getElementById("pill");
const nameEl=document.getElementById("name");
const sevenId="01G4HWTTYG000D3DGNAYJJPAB4";

function set(t){ pill.textContent=t; console.log(t); }

async function tryJson(url){
  try{
    const r=await fetch(url,{cache:"no-store"});
    if(!r.ok) return {ok:false, url, status:r.status};
    const j=await r.json();
    return {ok:true, url, j};
  }catch(e){
    return {ok:false, url, err:String(e?.message||e)};
  }
}

function pickPaint(obj){
  if(!obj || typeof obj!=="object") return null;

  // common containers
  const candidates = [
    obj.paint,
    obj.user?.paint,
    obj.cosmetics?.paint,
    obj.user?.cosmetics?.paint,
    obj?.data?.paint,
    obj?.data?.cosmetics?.paint
  ];

  for (const c of candidates){
    if(c && typeof c==="object") return c;
  }

  // arrays
  const arrays = [
    obj.paints,
    obj.cosmetics?.paints,
    obj.user?.paints,
    obj.user?.cosmetics?.paints,
    obj.data?.paints,
    obj.data?.cosmetics?.paints
  ];
  for (const a of arrays){
    if(Array.isArray(a) && a.length){
      const p = a.find(x=>x && typeof x==="object");
      if(p) return p;
    }
  }

  return null;
}

function buildCss(paint){
  if(!paint) return null;

  if(typeof paint.css==="string" && paint.css.trim()){
    return paint.css.trim().endsWith(";") ? paint.css.trim() : paint.css.trim()+";";
  }

  const stops = paint.stops || paint.gradient?.stops;
  const angle = paint.angle ?? paint.gradient?.angle ?? 90;
  const repeat = !!(paint.repeat ?? paint.gradient?.repeat);

  if(Array.isArray(stops) && stops.length>=2){
    const parts = stops.map(s=>{
      const c = s.color || s.colour || s.hex;
      const at = s.at ?? s.position;
      if(!c) return null;
      return at==null ? `${c}` : `${c} ${Math.round(at*100)}%`;
    }).filter(Boolean);

    if(parts.length>=2){
      const fn = repeat ? "repeating-linear-gradient" : "linear-gradient";
      return `background-image:${fn}(${angle}deg, ${parts.join(", ")});`;
    }
  }

  const url = paint.url || paint.image_url || paint.image;
  if(url){
    const safe = url.startsWith("http") ? url : ("https:" + url);
    return `background-image:url("${safe}"); background-size:cover; background-repeat:no-repeat;`;
  }

  const color = paint.color || paint.colour;
  if(color) return `color:${color};`;

  return null;
}

(async function run(){
  set("checking cosmetics endpoints…");

  const urls = [
    `https://7tv.io/v3/cosmetics?user_id=${encodeURIComponent(sevenId)}`,
    `https://7tv.io/v3/cosmetics?user=${encodeURIComponent(sevenId)}`,
    `https://7tv.io/v3/users/${encodeURIComponent(sevenId)}/cosmetics`,
    `https://7tv.io/v3/users/${encodeURIComponent(sevenId)}`,
    `https://7tv.io/v3/users/${encodeURIComponent(sevenId)}/profile`
  ];

  for(const url of urls){
    const res = await tryJson(url);
    if(!res.ok) continue;

    const paint = pickPaint(res.j);
    const css = buildCss(paint);

    if(css){
      nameEl.classList.add("paintText");
      nameEl.style.cssText += css;
      set(`paintSelf=1 source=${url}`);
      return;
    }
  }

  set("paintSelf=0 (no cosmetics paint found on tried endpoints)");
})();
</script>
</body>
</html>
